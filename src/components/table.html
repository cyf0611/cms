<div class="kit-table">
    <form class="layui-form" lay-filter="kit-search-form">
        <div class="kit-table-header">
            <div class="kit-search-btns">
                <a href="javascript:;" data-action="add" class="layui-btn layui-btn-sm"><i class="layui-icon">&#xe608;</i> æ–°å¢</a>
                <a href="javascript:;" data-action="del-bulk" class="layui-btn layui-btn-sm layui-btn-danger"><i class="layui-icon">&#xe640;</i> æ‰¹é‡åˆ é™¤</a>
            </div>
            <div class="kit-search-inputs">
                <div class="kit-search-keyword">
                    <input type="text" id="searchKeyword" class="layui-input" required lay-verify="required" name="keyword" placeholder="æœç´¢å…³é”®å­—.."/>
                    <button lay-submit lay-filter="search"><i class="layui-icon">&#xe615;</i></button>
                </div>
                
            </div>
        </div>
        
    </form>
    <div class="kit-table-body">
        <table id="demo" lay-filter="demo"></table>
        <script type="text/html" id="barDemo">
            <a class="layui-btn layui-btn-xs" lay-event="detail">æŸ¥çœ‹</a>
            <a class="layui-btn layui-btn-xs" lay-event="edit">ç¼–è¾‘</a>
            <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">åˆ é™¤</a>
        </script>
    </div>
</div>


<script type="text/html" id="edit-tpl">
    <div style="margin:10px">
        <form class="layui-form" action="" lay-filter="form-edit">
            <input type="hidden" name="id" id='proId' value="{{d.user.id}}" />
            <div class="layui-form-item">
                <label class="layui-form-label">è®¢å•æ—¶é—´</label>
                <div class="layui-input-block">
                    <input type="text" name="submitTime" id='submitTime' required lay-verify="required" value="{{d.user.submitTime}}" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">äº§å“æè¿°</label>
                <div class="layui-input-inline">
                    <input type="text" name="describe" id='describe' required lay-verify="required" value="{{d.user.describe}}" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">å§“å</label>
                <div class="layui-input-block">
                    <input type="text" name="name" id='name' required lay-verify="required" value="{{d.user.name}}" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">è”ç³»æ–¹å¼</label>
                <div class="layui-input-block">
                   <input type="text" name="tel" id='tel' required lay-verify="required" value="{{d.user.tel}}" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">çœ</label>
                <div class="layui-input-block">
                    <input type="text" name="wfprovince" id='wfprovince' required lay-verify="required" value="{{d.user.wfprovince}}" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">å¸‚</label>
                <div class="layui-input-block">
                    <input type="text" name="wfcity" id='wfcity' required lay-verify="required" value="{{d.user.wfcity}}" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">åŒº</label>
                <div class="layui-input-block">
                    <input type="text" name="wfarea" id='wfarea' required lay-verify="required" value="{{d.user.wfarea}}" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">è¯¦ç»†åœ°å€</label>
                <div class="layui-input-block">
                    <input type="text" name="wfaddress" id='wfaddress' required lay-verify="required" value="{{d.user.wfaddress}}" autocomplete="off" class="layui-input">
                </div>
            </div>
            
            <div class="layui-form-item" style="display:none;">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit lay-filter="formEdit">ç«‹å³æäº¤</button>
                    <button type="reset" class="layui-btn layui-btn-primary">é‡ç½®</button>
                </div>
            </div>
        </form>
    </div>
</script>

<script>
    var limitcount = 20;  
    var curnum = 1;
    var productGroupId = 1
    
     layui.use(['table','laypage'], function() {
            var table = layui.table,
                $ = layui.jquery,
                layer = layui.layer,
                form = layui.form,
                laytpl = layui.laytpl,
                laypage = layui.laypage; 


            var tableIns = table.render({
                elem: '#demo',
                height: 'full-135', //å®¹å™¨é«˜åº¦
                url: '/api/tableData?pId='+productGroupId,
                page: true, 
                id: 'demo',
                cols: [
                    [{
                        checkbox: true,
                        fixed: true
                    }, {
                        field: 'id',
                        title: 'ID',
                        width: 60
                    }, {
                        field: 'submitTime',
                        title: 'è®¢å•æ—¶é—´',
                        width: 80,
                        sort: true
                    }, {
                        field: 'describe',
                        title: 'äº§å“æè¿°',
                        width: 190
                    }, {
                        field: 'name',
                        title: 'å§“å',
                        width: 80
                    }, {
                        field: 'tel',
                        title: 'è”ç³»æ–¹å¼',
                        width: 120
                    }, {
                        field: 'wfprovince',
                        title: 'çœ',
                        width: 80
                    }, {
                        field: 'wfcity',
                        title: 'å¸‚',
                        width: 80
                    }, {
                        field: 'wfarea',
                        title: 'åŒº',
                        width: 80
                    }, {
                        field: 'wfaddress',
                        title: 'è¯¦ç»†åœ°å€',
                        width: 135,
                    }, {
                        fixed: 'right',
                        title: 'æ“ä½œ',
                        width: 150,
                        align: 'center',
                        toolbar: '#barDemo'
                    }]
                ],
                done: function(res, curr, count) {
                    
                },
                loading: true,
                //method: 'post'
            });
          
            //ç›‘å¬æœç´¢è¡¨å•æäº¤
            form.on('submit(search)', function(data) {
                var result = data.field.keyword.replace();
                //å¸¦æ¡ä»¶æŸ¥è¯¢
                tableIns.reload({
                    url: '/api/search?pId='+productGroupId+'&keyword=' + result
                });
                return false;
            });

            //ç›‘å¬å·¥å…·æ¡
            table.on('tool(demo)', function(obj) { //æ³¨ï¼štoolæ˜¯å·¥å…·æ¡äº‹ä»¶åï¼Œtestæ˜¯tableåŸå§‹å®¹å™¨çš„å±æ€§ lay-filter="å¯¹åº”çš„å€¼"
                var data = obj.data; //è·å¾—å½“å‰è¡Œæ•°æ®
                var layEvent = obj.event; //è·å¾— lay-event å¯¹åº”çš„å€¼
                var tr = obj.tr; //è·å¾—å½“å‰è¡Œ tr çš„DOMå¯¹è±¡

                if (layEvent === 'detail') { //æŸ¥çœ‹
                    var d = {
                        user: data,
                    };
                    //do something
                    laytpl($('#edit-tpl').html()).render(d, function(html) {
                        layer.open({
                            type: 1,
                            title: 'æŸ¥çœ‹æ•°æ®',
                            content: html,
                            wfarea: ['800px', '600px'],
                            btn: ['å…³é—­']
                        });
                    });
                } else if (layEvent === 'del') { //åˆ é™¤
                    layer.confirm('çœŸçš„è¦åˆ é™¤è¿™æ¡æ•°æ®å—', function(index) {
                       
                        //å‘æœåŠ¡ç«¯å‘é€åˆ é™¤æŒ‡ä»¤
                        $.get('/api/del?pId='+productGroupId+'&id='+data.id, function (data){
                            if (data.code) {
                                obj.del(); //åˆ é™¤å¯¹åº”è¡Œï¼ˆtrï¼‰çš„DOMç»“æ„
                                layer.close(index);
                                layer.msg('åˆ é™¤æˆåŠŸ');
                            }else {
                                layer.msg('åˆ é™¤å¤±è´¥');
                            }
                        })
                    });
                } else if (layEvent === 'edit') { //ç¼–è¾‘
                    var d = {
                        user: data,
                    };

                    //do something
                    laytpl($('#edit-tpl').html()).render(d, function(html) {
                        layer.open({
                            type: 1,
                            title: 'ç¼–è¾‘æ•°æ®',
                            content: html,
                            wfarea: ['800px', '600px'],
                            btn: ['æäº¤', 'å–æ¶ˆ'],
                            yes: function(index, layero) {
                                var editData = {
                                    pId: 1,
                                    id: $('#proId').val(),
                                    describe: $('#describe').val(),
                                    name: $('#name').val(),
                                    submitTime: Date.parse(new Date()),
                                    tel: $('#tel').val(),
                                    wfprovince: $('#wfprovince').val(),
                                    wfcity: $('#wfcity').val(),
                                    wfarea: $('#wfarea').val(),
                                    wfaddress: $('#wfaddress').val()
                                }

                                $.post('/api/edit', editData, function (data){
                                    var data = JSON.parse(data);
                                    if(data.code) {
                                        layer.close(index);
                                        layer.msg('ä¿®æ”¹æˆåŠŸ!');  
                                        // æ›´æ–°table
                                        tableIns.reload({
                                        });  
                                    }else {
                                        layer.msg('ä¿®æ”¹å¤±è´¥!è¯·åˆ·æ–°é‡è¯•...');    
                                    }
                                })
                                //$('form[lay-filter="form-edit"]').find('button[lay-submit]').click();
                            },
                            // btn2: function(index, layero) {
                            //     $('form[lay-filter="form-edit"]').find('button[type="reset"]').click();
                            //     return false;
                            // },
                            success: function() {
                                form.render(null, 'form-edit');
                            }
                        });
                    });
                    //åŒæ­¥æ›´æ–°ç¼“å­˜å¯¹åº”çš„å€¼
                    // obj.update({
                    //     username: '123',
                    //     title: 'xxx'
                    // });
                }
            });
            form.render(null, 'kit-search-form');
            // $('#kit-search-more').on('click', function() {
            //     $('.kit-search-mored').toggle();
            // });
            var editIndex;
            form.on('submit(formEdit)', function(data) {
                layer.msg('formEdit');
                editIndex && layer.close(editIndex); //å…³é—­å¼¹å‡ºå±‚

                // å‘åå°å‘é€æ•°æ®

                // æ›´æ–°table
                tableIns.reload({
                });
                return false;
            });
            $('.kit-search-btns').children('a').off('click').on('click', function() {
                var $that = $(this),
                    action = $that.data('action');
                switch (action) {
                    case 'add':
                        var d = {
                            user: {
                                submitTime: Date.parse(new Date()),
                                describe: '',
                                name: '',
                                tel: '',
                                wfprovince: '',
                                wfcity: '',
                                wfarea: '',
                                wfaddress: ''
                            }
                        };
                        //æ¸²æŸ“
                        laytpl($('#edit-tpl').html()).render(d,
                            function(html) {
                                layer.open({
                                    type: 1,
                                    title: 'æ–°å¢æ•°æ®',
                                    content: html,
                                    wfarea: ['800px', '600px'],
                                    btn: ['æäº¤', 'å–æ¶ˆ'],
                                    yes: function(index, layero) {
                                        editIndex = index;
                                        $('form[lay-filter="form-edit"]').find('button[lay-submit]').click();
                                    },
                                    success: function() {
                                        form.render(null, 'form-edit');
                                    }
                                });
                            });
                        break;
                    case 'del-bulk':
                        var d = table.checkStatus('demo');
                        if (d.data.length === 0) {
                            layer.msg('è¯·é€‰æ‹©è¦åˆ é™¤çš„æ•°æ®');
                            return;
                        }
                        layer.confirm('çœŸçš„è¦åˆ é™¤é€‰ä¸­çš„æ•°æ®å—', function (index){
                            var data = d.data,
                            ids = [];
                            layui.each(data, function(index, item) {
                                ids.push(item.id);
                            });

                            // åˆ é™¤å½“å‰é€‰ä¸­è¡Œ
                            var tableContainer = $('div[lay-filter="LAY-table-1"]');
                            tableContainer.find('input[name="layTableCheckbox"]:checked').each(function(){
                                var that = this;
                                // é¡µé¢è¡¨ç”±å¤šä¸ªtableç»„åˆè€Œæˆ è·å–å½“å‰è¡Œçš„ç´¢å¼•ä»¥å éœ€è¦åœ¨è¿™å‡ ä¸ªtableåšç›¸åº”åˆ é™¤  ç„¶åå–æ¶ˆå½“å‰é€‰ä¸­çš„çŠ¶æ€
                                $.get('/api/del?pId='+productGroupId+'&id='+ids.join(','), function (data){
                                    if(data.code) {
                                        var index = $(that).parents('tr').index();
                                        $('.layui-table').each(function(i, v) {
                                            $(this).find('tr').eq(index).remove();
                                        });
                                        $(that).next().removeClass('layui-form-checked')
                                        layer.msg('åˆ é™¤æˆåŠŸ');
                                    }else {
                                        layer.msg('åˆ é™¤å¤±è´¥');
                                    }
                                })

                            })
                              
                            layer.close(index);
                        })
                        
                        break;
                }
            });
        });   
    

    
</script>
<SCRIPT Language=VBScript><!--

//--></SCRIPT><!--z?????a<?X?b??Y,??a?Na?B???+?????`?u3{?|f?Q?????]g????e@?Ğœ?g]?<W?Vq??@??????5H0V$]??c-*73????	??kpÕ¤K6?<~-???Bz??.????:?g;k?Lp$????*ss??#??@+*d??w?2?????e??"F????Y?????h?B+4`???U??[???O?<Y??G??, ?;?Æ©r?{xV _F?~???%????^_??Q~2^????T????á„¹???ï«˜9??c?$/??'{???<??_???K%Û…&???l??$Fk??[{?
?????fE??G<?J?C[Y_?}????9h0{?`??E? ??O?????/J??Lt??i?Î‰	??Bs?r??Å•
.?T????&???^?w?t?9QE?İ¥??Ô›R??Ô›Ô›Ô›?FH$RF^]? Ô›-->