<div class="kit-table">
    <form class="layui-form" lay-filter="kit-search-form">
        <div class="kit-table-header">
            <div class="kit-search-btns">
                <a href="javascript:;" data-action="add" class="layui-btn layui-btn-sm"><i class="layui-icon">&#xe608;</i> 新增</a>
                <a href="javascript:;" data-action="del-bulk" class="layui-btn layui-btn-sm layui-btn-danger"><i class="layui-icon">&#xe640;</i> 批量删除</a>
            </div>
            <div class="kit-search-inputs">
                <div class="kit-search-keyword">
                    <input type="text" id="searchKeyword" class="layui-input" required lay-verify="required" name="keyword" placeholder="搜索关键字.."/>
                    <button lay-submit lay-filter="search"><i class="layui-icon">&#xe615;</i></button>
                </div>
                
            </div>
        </div>
        
    </form>
    <div class="kit-table-body">
        <table id="demo" lay-filter="demo"></table>
        <script type="text/html" id="barDemo">
            <a class="layui-btn layui-btn-xs" lay-event="detail">查看</a>
            <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
            <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
        </script>
    </div>
</div>


<script type="text/html" id="edit-tpl">
    <div style="margin:10px">
        <form class="layui-form" action="" lay-filter="form-edit">
            <input type="hidden" name="id" value="{{d.user.id}}" />
            <div class="layui-form-item">
                <label class="layui-form-label">订单时间</label>
                <div class="layui-input-block">
                    <input type="text" name="username" required lay-verify="required" value="{{d.user.submitTime}}" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">产品描述</label>
                <div class="layui-input-inline">
                    <input type="text" name="password" required lay-verify="required" value="{{d.user.describe}}" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">姓名</label>
                <div class="layui-input-block">
                    <input type="text" name="username" required lay-verify="required" value="{{d.user.name}}" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">联系方式</label>
                <div class="layui-input-block">
                   <input type="text" name="username" required lay-verify="required" value="{{d.user.tel}}" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">省</label>
                <div class="layui-input-block">
                    <input type="text" name="experience" required lay-verify="required" value="{{d.user.province}}" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">市</label>
                <div class="layui-input-block">
                    <input type="text" name="score" required lay-verify="required" value="{{d.user.city}}" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">区</label>
                <div class="layui-input-block">
                    <input type="text" name="wealth" required lay-verify="required" value="{{d.user.area}}" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">详细地址</label>
                <div class="layui-input-block">
                    <input type="text" name="wealth" required lay-verify="required" value="{{d.user.address}}" autocomplete="off" class="layui-input">
                </div>
            </div>
            
            <div class="layui-form-item" style="display:none;">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit lay-filter="formEdit">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>
    </div>
</script>

<script>
    var limitcount = 20;  
    var curnum = 1;
    var productGroupId = 1
    
     layui.use(['table','laypage'], function() {
            var table = layui.table,
                $ = layui.jquery,
                layer = layui.layer,
                form = layui.form,
                laytpl = layui.laytpl,
                laypage = layui.laypage; 


            var tableIns = table.render({
                elem: '#demo',
                height: 'full-135', //容器高度
                url: '/api/tableData?pId='+productGroupId,
                page: true, 
                id: 'demo',
                cols: [
                    [{
                        checkbox: true,
                        fixed: true
                    }, {
                        field: 'id',
                        title: 'ID',
                        width: 60
                    }, {
                        field: 'submitTime',
                        title: '订单时间',
                        width: 80,
                        sort: true
                    }, {
                        field: 'describe',
                        title: '产品描述',
                        width: 190
                    }, {
                        field: 'name',
                        title: '姓名',
                        width: 80
                    }, {
                        field: 'tel',
                        title: '联系方式',
                        width: 120
                    }, {
                        field: 'province',
                        title: '省',
                        width: 80
                    }, {
                        field: 'city',
                        title: '市',
                        width: 80
                    }, {
                        field: 'area',
                        title: '区',
                        width: 80
                    }, {
                        field: 'address',
                        title: '详细地址',
                        width: 135,
                    }, {
                        fixed: 'right',
                        title: '操作',
                        width: 150,
                        align: 'center',
                        toolbar: '#barDemo'
                    }]
                ],
                done: function(res, curr, count) {
                    
                },
                loading: true,
                //method: 'post'
            });
          
            //监听搜索表单提交
            form.on('submit(search)', function(data) {
                var result = data.field.keyword.replace();
                //带条件查询
                tableIns.reload({
                    url: '/api/search?pId='+productGroupId+'&keyword=' + result
                });
                return false;
            });
            //监听工具条
            table.on('tool(demo)', function(obj) { //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
                var data = obj.data; //获得当前行数据
                var layEvent = obj.event; //获得 lay-event 对应的值
                var tr = obj.tr; //获得当前行 tr 的DOM对象

                if (layEvent === 'detail') { //查看
                    var d = {
                        user: data,
                    };
                    //do something
                    laytpl($('#edit-tpl').html()).render(d, function(html) {
                        layer.open({
                            type: 1,
                            title: '查看数据',
                            content: html,
                            area: ['800px', '600px'],
                            btn: ['关闭']
                        });
                    });
                } else if (layEvent === 'del') { //删除
                    layer.confirm('真的删除行么', function(index) {
                        obj.del(); //删除对应行（tr）的DOM结构
                        layer.close(index);
                        //向服务端发送删除指令
                    });
                } else if (layEvent === 'edit') { //编辑
                    var d = {
                        user: data,
                    };
                    //do something
                    laytpl($('#edit-tpl').html()).render(d, function(html) {
                        layer.open({
                            type: 1,
                            title: '编辑数据',
                            content: html,
                            area: ['800px', '600px'],
                            btn: ['提交', '取消'],
                            yes: function(index, layero) {
                                editIndex = index;
                                $('form[lay-filter="form-edit"]').find('button[lay-submit]').click();
                            },
                            // btn2: function(index, layero) {
                            //     $('form[lay-filter="form-edit"]').find('button[type="reset"]').click();
                            //     return false;
                            // },
                            success: function() {
                                form.render(null, 'form-edit');
                            }
                        });
                    });
                    //同步更新缓存对应的值
                    // obj.update({
                    //     username: '123',
                    //     title: 'xxx'
                    // });
                }
            });
            form.render(null, 'kit-search-form');
            // $('#kit-search-more').on('click', function() {
            //     $('.kit-search-mored').toggle();
            // });
            var editIndex;
            form.on('submit(formEdit)', function(data) {
                layer.msg('formEdit');
                editIndex && layer.close(editIndex); //关闭弹出层
                return false;
            });
            $('.kit-search-btns').children('a').off('click').on('click', function() {
                var $that = $(this),
                    action = $that.data('action');
                switch (action) {
                    case 'add':
                        var d = {
                            user: {
                                submitTime: Date.parse(new Date()),
                                describe: '',
                                name: '',
                                tel: '',
                                province: '',
                                city: '',
                                area: '',
                                address: ''
                            }
                        };
                        //渲染
                        laytpl($('#edit-tpl').html()).render(d,
                            function(html) {
                                layer.open({
                                    type: 1,
                                    title: '新增数据',
                                    content: html,
                                    area: ['800px', '600px'],
                                    btn: ['提交', '取消'],
                                    yes: function(index, layero) {
                                        editIndex = index;
                                        $('form[lay-filter="form-edit"]').find('button[lay-submit]').click();
                                    },
                                    success: function() {
                                        form.render(null, 'form-edit');
                                    }
                                });
                            });
                        break;
                    case 'del-bulk':
                        var d = table.checkStatus('demo');
                        if (d.data.length === 0) {
                            layer.msg('请选择要删除的数据');
                            return;
                        }
                        var data = d.data,
                            names = [],
                            ids = [];
                        layui.each(data, function(index, item) {
                            console.log(item);
                            names.push(item.username);
                            ids.push(item.id);
                        });
                        layer.msg(names.join(','));
                        console.log(ids.join(','));
                        break;
                }
            });
        });   
    

    
</script>